YUI.add("moodle-tinymce_mathslate-editor",function(l,t){var c,f;M&&(M.tinymce_mathslate=M.tinymce_mathslate||{}),c=M&&M.tinymce_mathslate||{},f={TOOLBOX:"mathslate-toolbox",DRAGNODE:"mathslate-toolbox-drag",UNDO:"mathslate-undo-button",REDO:"mathslate-redo-button",CLEAR:"mathslate-clear-button",HELP:"mathslate-help-button"},c.Editor=function(t,e,i){var a,o,s,n,d,r,u,h=window.MathJax;i=i||{texInput:!0},(a=this).node=l.one(t),this.node.setHTML(M.util.get_string("nomathjax","tinymce_mathslate")),h.Hub.processSectionDelay=0,o=l.guid(),s=l.guid(),n=l.guid(),this.node.addClass(f.EDITOR),this.node.setHTML('<div id="'+o+'" class="'+f.TOOLBOX+'"><div style="background-color: white; color: green; height: 300px; line-height: 75px; font-size: 18px; text-align:center"><br />Mathslate Mathematics Editor<br />Version 1.1</div><script type="math/tex">\\quad<\/script><math> <mo> </mo></math></div><div id="'+n+'" ></div>'),d=new c.MathJaxEditor("#"+n),r={tools:[],Tool:function(t){this.id=l.guid(),this.json=JSON.stringify(t),this.HTMLsnippet=[["span",{id:this.id,title:function n(e){if("string"==typeof e)return e;if("undefined"==typeof e[1])return"";var o="";return"undefined"!=typeof e[1].tex?(e[1].tex.forEach(function(t){o+="string"==typeof t?t:n(e[2][t])}),o):"string"==typeof e[2]?e[2]:"undefined"==typeof e[2]?"":(e[2].forEach(function(t){o+=n(t)}),o)}(t)},[["math",{},[t]]]]],function o(e){Array.isArray(e[2])&&e[2].forEach(function(t){Array.isArray(t)?o(t):"[]"===t&&(e[2][e[2].indexOf(t)]=["mn",{},"[]"])})}(t),r.tools.push(this)},fillToolBox:function(t,e){var o,n={children:[]};return h.Hub.Register.StartupHook("TeX Jax Config",function(){i.texInput&&(h.Ajax.Require("[MathJax]/extensions/toMathML.js"),n.children.push({label:'<span title="TeX"><math><mi>T</mi><mspace width="-.14em"/><mpadded height="-.5ex" depth="+.5ex" voffset="-.5ex"><mrow class="MJX-TeXAtom-ORD"><mi>E</mi></mrow></mpadded><mspace width="-.115em" /> <mi>X</mi> </math></span>',content:"<span id='"+s+"'></span>"}))}),h.Hub.Register.StartupHook("End",function(){t.forEach(function(t){var o=l.Node.create("<p></p>");t.tools.forEach(function(t){if(t[0]&&"br"===t[0])o.append("<br />");else{var e=new r.Tool(t);o.append("<span> "+d.toMathML(e.HTMLsnippet)+" </span>")}}),n.children.push({label:t.label,content:o.getHTML()})}),o=new l.TabView(n),a.output=function(t){return d.output(t)},l.one("#"+e)&&(l.one("#"+e).setHTML(""),o.render("#"+e),l.one("#"+s)&&new c.TeXTool("#"+s,function(t){d.addMath(t)})),h.Hub.Queue(["Typeset",h.Hub,e]),h.Hub.Queue(function(){r.tools.forEach(function(t){l.one("#"+e)&&l.one("#"+e).one("#"+t.id)&&r.registerTool(t)})})}),o},getToolByID:function(e){var o;return this.tools.forEach(function(t){t.id&&t.id===e&&(o=t)}),o},registerTool:function(t){if(l.one("#"+t.id)){var e=new l.DD.Drag({node:"#"+t.id});e.set("data",t.json),e.on("drag:start",function(){this.get("dragNode").addClass(f.DRAGNODE)}),e.on("drag:end",function(){this.get("node").setStyle("top","0"),this.get("node").setStyle("left","0"),this.get("node").removeClass(f.DRAGNODE)})}}},h.Hub.Queue(["Typeset",h.Hub,o]),l.on("io:success",function(t,e){u.id===t&&h.Hub.Queue(["fillToolBox",r,l.JSON.parse(e.response),o])}),u=e===undefined?l.io(c.config):l.io(e),this.tbox=r,(this.mje=d).canvas.on("drop:hit",function(t){t.drag.get("data")&&d.addMath(t.drag.get("data"))}),l.one("#"+o).delegate("click",function(){var t=r.getToolByID(this.getAttribute("id"));t&&d.addMath(t.json)},"span .yui3-dd-draggable")}},"@VERSION@",{requires:["dd-drag","dd-proxy","dd-drop","event","tabview","io-base","json","moodle-tinymce_mathslate-textool","moodle-tinymce_mathslate-mathjaxeditor"]});